---
# Source: digitalhub/templates/tests/dhub-test/test-configmap.yaml
# SPDX-FileCopyrightText: © 2025 DSLab - Fondazione Bruno Kessler
#
# SPDX-License-Identifier: AGPL-3.0-or-later

apiVersion: v1
kind: ConfigMap
metadata:
  name: digitalhub-python-test
data:
  s1-etl.py: "# SPDX-FileCopyrightText: © 2025 DSLab - Fondazione Bruno Kessler\n#\n# SPDX-License-Identifier: AGPL-3.0-or-later\n\nimport sys\nimport digitalhub as dh\nfrom time import time, sleep\nimport os\nfrom oauthlib.oauth2 import BackendApplicationClient\nfrom requests_oauthlib import OAuth2Session\n\ndef main():\n    if \"CORE_CLIENT_ID\" in os.environ:\n        # Get Core Token\n        client_id = os.getenv(\"CORE_CLIENT_ID\")\n        client_secret = os.getenv(\"CORE_CLIENT_SECRET\")\n        client = BackendApplicationClient(client_id=client_id)\n        oauth = OAuth2Session(client=client)\n        token = oauth.fetch_token(token_url='http://digitalhub-core:8080/auth/token', client_id=client_id, client_secret=client_secret)\n        os.environ[\"DHCORE_ACCESS_TOKEN\"] = token[\"access_token\"]\n\n    # Load project\n    try:\n      proj = dh.import_project(\"projects-tutorial-project.yaml\")\n    except:\n      proj = dh.load_project(\"projects-tutorial-project.yaml\")\n\n    URL = \"https://opendata.comune.bologna.it/api/explore/v2.1/catalog/datasets/rilevazione-flusso-veicoli-tramite-spire-anno-2023/exports/csv?lang=it&timezone=Europe%2FRome&use_labels=true&delimiter=%3B\"\n    di= proj.new_dataitem(name=\"url_data_item\",kind=\"table\",path=URL)\n\n    proj.run('pipeline', action=\"build\", wait=True)\n    workflow_run = proj.run('pipeline', action=\"pipeline\", parameters={\"url\": di.key}, wait=True)\n    if(workflow_run.status.state == \"COMPLETED\"):\n      sys.exit(0)\n    else:\n      sys.exit(1)\n\n\nif __name__ == \"__main__\":\n    main()\n"
  s2-dbt.py: "# SPDX-FileCopyrightText: © 2025 DSLab - Fondazione Bruno Kessler\n#\n# SPDX-License-Identifier: AGPL-3.0-or-later\n\nimport sys\nimport digitalhub as dh\nfrom time import time, sleep\nimport os\nfrom oauthlib.oauth2 import BackendApplicationClient\nfrom requests_oauthlib import OAuth2Session\n\ndef main():\n    if \"CORE_CLIENT_ID\" in os.environ:\n        # Get Core Token\n        client_id = os.getenv(\"CORE_CLIENT_ID\")\n        client_secret = os.getenv(\"CORE_CLIENT_SECRET\")\n        client = BackendApplicationClient(client_id=client_id)\n        oauth = OAuth2Session(client=client)\n        token = oauth.fetch_token(token_url='http://digitalhub-core:8080/auth/token', client_id=client_id, client_secret=client_secret)\n        os.environ[\"DHCORE_ACCESS_TOKEN\"] = token[\"access_token\"]\n\n    # Load project\n    try:\n      proj = dh.import_project(\"projects-tutorial-project.yaml\")\n    except:\n      proj = dh.load_project(\"projects-tutorial-project.yaml\")\n\n    url = \"https://gist.githubusercontent.com/kevin336/acbb2271e66c10a5b73aacf82ca82784/raw/e38afe62e088394d61ed30884dd50a6826eee0a8/employees.csv\"\n    di_url = proj.new_dataitem(name=\"url-data-item\",kind=\"table\",path=url)\n\n    proj.run('dbt-pipeline', action=\"build\", wait=True)\n    workflow_run = proj.run('dbt-pipeline', action=\"pipeline\", parameters={\"employees\": di_url.key}, wait=True)\n    if(workflow_run.status.state == \"COMPLETED\"):\n      sys.exit(0)\n    else:\n      sys.exit(1)\n\nif __name__ == \"__main__\":\n    main()\n"
  s3-scikit-learn.py: "# SPDX-FileCopyrightText: © 2025 DSLab - Fondazione Bruno Kessler\n#\n# SPDX-License-Identifier: AGPL-3.0-or-later\n\nimport sys\nimport digitalhub as dh\nfrom time import time, sleep\nimport os\nfrom oauthlib.oauth2 import BackendApplicationClient\nfrom requests_oauthlib import OAuth2Session\n\ndef main():\n    if \"CORE_CLIENT_ID\" in os.environ:\n        # Get Core Token\n        client_id = os.getenv(\"CORE_CLIENT_ID\")\n        client_secret = os.getenv(\"CORE_CLIENT_SECRET\")\n        client = BackendApplicationClient(client_id=client_id)\n        oauth = OAuth2Session(client=client)\n        token = oauth.fetch_token(token_url='http://digitalhub-core:8080/auth/token', client_id=client_id, client_secret=client_secret)\n        os.environ[\"DHCORE_ACCESS_TOKEN\"] = token[\"access_token\"]\n\n    # Load project\n    try:\n      proj = dh.import_project(\"projects-tutorial-project.yaml\")\n    except:\n      proj = dh.load_project(\"projects-tutorial-project.yaml\")\n\n    proj.run('ml-pipeline', action=\"build\", wait=True)\n    workflow_run = proj.run('ml-pipeline', action=\"pipeline\", wait=True)\n    if(workflow_run.status.state == \"COMPLETED\"):\n      dh.delete_project(proj.name)\n    else:\n      sys.exit(1)\n\n\nif __name__ == \"__main__\":\n    main()\n"
---
# Source: digitalhub/templates/tests/dhub-test/test-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: digitalhub-python-script-test
data:
  init-python-script.sh: "#!/bin/sh\n\n# SPDX-FileCopyrightText: © 2025 DSLab - Fondazione Bruno Kessler\n#\n# SPDX-License-Identifier: AGPL-3.0-or-later\n\ncp home/src/$TEST_SCRIPT home/git/digitalhub-tutorials/$TEST_FOLDER/$TEST_SCRIPT\ncd home/git/digitalhub-tutorials/$TEST_FOLDER\npip install digitalhub-runtime-container==0.14.0 digitalhub-runtime-dbt==0.14.0 digitalhub-runtime-flower==0.14.0 digitalhub-runtime-hera==0.14.0 digitalhub-runtime-kfp==0.14.0 digitalhub-runtime-modelserve==0.14.0 digitalhub-runtime-python==0.14.0 digitalhub[full]==0.14.0 requests-oauthlib\npython $TEST_SCRIPT\n"
